<!doctype html>
<html>
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width; initial-scale=0.5; maximum-scale=1.0; minimum-scale=0.5; user-scalable=yes;" />
<title>資生堂</title>
<style type="text/css">

body{ background:#fff; margin:0 ; padding:0; font-family: Arial,SimHei;-webkit-text-size-adjust: none; font-size:63%;}
img{ border:none; vertical-align:top;}
#content { width:640px ; margin:0 auto; text-align:center; color:#777; padding-bottom:60px;}


</style>
<script src="http://code.jquery.com/jquery-latest.min.js"></script>

<script type="text/javascript">
    var linkUrl = 'http://tw.adon.vpon.com/xpon/activity/8a80818243dca2ad01440b8b5d53688d/gift.html?store=';
    function submitData(){

        var cellNo = jQuery.trim(jQuery("#phone").val());
        var name = jQuery.trim(jQuery("#name").val());
        var storeName = jQuery("#selectStore option:selected").text();

        linkUrl += storeName;
        console.log(linkUrl);
        shortURL(name,cellNo,storeName);

    }
	
	//縮短網址
	function shortURL(name,cellNo,storeName){
		var request = gapi.client.urlshortener.url.insert({
			'resource': {'longUrl': linkUrl}
		});


		request.execute(function(response) {
			console.log("urlshortener:" + response.id);
			//簡訊訊息 
			smsContent = "憑簡訊連結頁面至"+storeName+"可兌換資生堂美透白奇蹟淡斑精華試用包乙包，每人限兌乙次>>" + response.id;
			//smsContent = "憑簡訊連結頁面"+response.id +"　至"+storeName+"可兌換資生堂美透白奇蹟淡斑精華試用包乙包，每人限兌乙次";
			sendSMS(name,cellNo,smsContent,linkUrl);
		});
		return true;
	}
	
    //寄發簡訊
    function sendSMS(name,cellNo,smsContent,linkUrl) {
        jQuery.ajax({
            url:'http://s1.vpon.com/test/sms_shiseido.php',
            dataType: 'jsonp',
            jsonpCallback: 'showContent',
            jsonp: 'callback',
            data: { name:name,
                phone:cellNo,
                content:smsContent
            },
            success: function(data, textStatus, jqXHR){
                console.log('success' + textStatus);
                console.log('success' + data);
                window.location = linkUrl;
            },
            error:  function(jqXHR, textStatus, errorThrown ) {
                console.log('fail:' + textStatus);
                console.log('fail:' + errorThrown);
            }
        });
    }
	
    function showContent(data) {
        console.log(data);
        console.log(data.u);
        alert('簡訊稍後將寄出至您的手機，一隻手機限兌換一次！');

    }
	
    function load() {
        gapi.client.setApiKey('AIzaSyCvtmYvx03lc6DZrM1x8zTJ8Ho-o7RHOYI');      //YOUR API KEY
        gapi.client.load('urlshortener', 'v1');
    }

</script>

<script src="https://apis.google.com/js/client.js?onload=load"></script>

</head>


<body>
<div id="content">

<div id="tab">
     <p>姓名:<input type="text" name="name" id="name"></p>
	 <p>email:<input type="text" name="mail" id="mail"></p>
     <p>手機:<input type="tel" name="phone" id="phone" maxlength="10"></p>
     <form name="selForm"><p>選擇兌換櫃點&nbsp;<select name="selectStore" id="selectStore">
         <option value="">請選擇</option>
         <option value="新光三越台北信義A8國際櫃">新光三越台北信義A8國際櫃</option>
     </select></p></form>  
</div>

<BUTTON style="WIDTH: 150px; HEIGHT: 80px; font-size:50px" onclick="submitData()">送出</BUTTON>
</div>
</body>
</html>
